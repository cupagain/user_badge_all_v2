<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SWAG DIAMOND PASS</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800;900&family=Noto+Sans+TC:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --card: #1a1a1c;
            --teal: #00e5cf;
            --teal-glow: rgba(0, 229, 207, 0.5);
            --gold: #ffcc00;
            --white: #ffffff;
            --silver: #e0e0e0;
            --border: rgba(255, 255, 255, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--white); font-family: 'Noto Sans TC', sans-serif; padding: 30px 20px; line-height: 1.4; }

        /* 標題與備註 */
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 30px; font-weight: 900; letter-spacing: -1px; }
        .month-num { color: var(--teal); font-family: 'Montserrat', sans-serif; font-size: 42px; margin-right: 4px; }
        .reset-note { font-size: 14px; color: var(--teal); margin-top: 8px; font-weight: 700; opacity: 0.9; }

        /* 領取英雄區 (Hero Section) */
        .hero {
            background: linear-gradient(180deg, #252528 0%, #161618 100%);
            border-radius: 28px; border: 1px solid var(--border);
            padding: 30px 20px; margin-bottom: 20px; text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }
        .hero-label { font-size: 16px; color: var(--silver); font-weight: 700; margin-bottom: 12px; }
        .hero-val { 
            font-family: 'Montserrat', sans-serif; font-size: 48px; font-weight: 900; 
            color: var(--white); margin-bottom: 25px; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .hero-val span { color: var(--teal); text-shadow: 0 0 20px var(--teal-glow); }

        /* 主按鈕 CTA */
        .cta-btn {
            width: 100%; padding: 20px; border-radius: 20px; border: none;
            font-size: 20px; font-weight: 900; letter-spacing: 1px; cursor: pointer;
            margin-bottom: 25px; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-active { background: var(--teal); color: #000; box-shadow: 0 8px 25px var(--teal-glow); }
        .btn-active:active { transform: scale(0.96); }
        .btn-disabled { background: #333; color: #777; cursor: not-allowed; }

        /* 統計數據區 */
        .stats { display: flex; gap: 12px; }
        .stat-box { 
            flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--border); 
            border-radius: 16px; padding: 15px 10px; text-align: center;
        }
        .stat-label { font-size: 13px; color: var(--silver); margin-bottom: 6px; font-weight: 700; }
        .stat-val { font-family: 'Montserrat', sans-serif; font-size: 22px; font-weight: 900; color: var(--white); }

        /* VIP 面板 */
        .vip-card {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            border-radius: 16px; padding: 15px 20px; margin-bottom: 40px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .vip-lv { font-family: 'Montserrat', sans-serif; font-size: 18px; font-weight: 900; color: var(--gold); }
        .vip-status { font-size: 14px; font-weight: 700; }
        .status-ok { color: #00ff80; }
        .status-no { color: #ff3e60; text-decoration: underline; cursor: pointer; }

        /* 規則清單區 (5 Columns Grid) */
        .rules-header { font-size: 20px; font-weight: 900; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .rules-header::before { content: ''; width: 6px; height: 24px; background: var(--teal); border-radius: 4px; }
        
        .rules-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; }
        .rule-cell {
            background: var(--card); border: 1.5px solid var(--border);
            border-radius: 12px; padding: 12px 2px; text-align: center;
            transition: 0.3s;
        }
        .rule-cell.claimed { opacity: 0.25; background: #000; }
        .rule-cell.active { border-color: var(--teal); background: rgba(0, 229, 207, 0.08); box-shadow: 0 0 15px rgba(0, 229, 207, 0.15); }
        
        .r-day { font-size: 11px; font-weight: 700; color: var(--silver); margin-bottom: 8px; display: block; }
        .r-amt-row { display: flex; align-items: center; justify-content: center; gap: 2px; }
        .r-icon { width: 14px; height: 14px; filter: drop-shadow(0 0 4px var(--teal-glow)); }
        .r-amt { font-family: 'Montserrat', sans-serif; font-size: 14px; font-weight: 800; color: var(--white); }

        /* Skeleton */
        .skeleton { height: 70px; background: #222; border-radius: 12px; animation: breathe 1.5s infinite; }
        @keyframes breathe { 0%, 100% { opacity: 0.5; } 50% { opacity: 0.8; } }
    </style>
</head>
<body>

<div class="header">
    <h1><span class="month-num" id="month-text">--</span>月連續簽到獎勵</h1>
    <p class="reset-note">天數於每月 1 日更新</p>
</div>

<div class="hero">
    <p class="hero-label">本日可領取</p>
    <div class="hero-val">
        <svg style="width:40px;height:40px;margin-right:8px" viewBox="0 0 24 24"><path fill="#00e5cf" d="M12 22L2 9L12 2L22 9L12 22Z"/></svg>
        <span id="today-val">--</span>
    </div>
    
    <button id="cta-btn" class="cta-btn btn-disabled">連線中...</button>

    <div class="stats">
        <div class="stat-box">
            <p class="stat-label">本月已領取</p>
            <p class="stat-val"><span id="days-val">--</span> 天</p>
        </div>
        <div class="stat-box">
            <p class="stat-label">總計已領取</p>
            <p class="stat-val"><span id="diamonds-val">--</span> 鑽</p>
        </div>
    </div>
</div>

<div class="vip-card">
    <div class="vip-lv" id="vip-lv">VIP LV.--</div>
    <div class="vip-status" id="vip-status">檢查資格中...</div>
</div>

<div class="rules-header">全月獎勵規則</div>
<div class="rules-grid" id="grid">
    <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
</div>

<script>
    // 配置：您的 Cloud Run API URL
    const API_URL = "https://swag-user-login-api-905468082258.asia-east1.run.app/api/user_login_status";

    const REWARDS = [
        50, 50, 70, 50, 100, 60, 60, 90, 60, 130,
        70, 70, 110, 70, 160, 80, 80, 130, 80, 190,
        90, 90, 150, 90, 300
    ];

    async function fetchData() {
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('user_id') || 'test_user';
        let data = { total_checkin_days: 0, vip_level: 0 };
        
        try {
            const response = await fetch(`${API_URL}?user_id=${userId}`);
            data = await response.json();
        } catch (e) { console.error("API Error", e); }
        
        renderUI(data);
    }

    function renderUI(data) {
        const claimedDays = data.total_checkin_days || 0;
        const vipLevel = data.vip_level || 0;
        const isQualified = vipLevel >= 10;
        const currentMonth = data.current_month ? new Date(data.current_month).getMonth() + 1 : new Date().getMonth() + 1;

        // 標題與月份
        document.getElementById('month-text').innerText = currentMonth;

        // 本日領取數
        const todayReward = REWARDS[claimedDays] || 0;
        document.getElementById('today-val').innerText = todayReward;

        // 統計看板
        document.getElementById('days-val').innerText = claimedDays;
        let totalClaimed = 0;
        for(let i=0; i<claimedDays; i++) totalClaimed += REWARDS[i];
        document.getElementById('diamonds-val').innerText = totalClaimed;

        // VIP 狀態
        document.getElementById('vip-lv').innerText = `VIP LV.${vipLevel}`;
        const statusEl = document.getElementById('vip-status');
        if (isQualified) {
            statusEl.innerHTML = `<span class="status-ok">符合資格</span>`;
        } else {
            statusEl.innerHTML = `<span class="status-no" onclick="location.href='#upgrade'">不符合資格，立即升級</span>`;
        }

        // CTA 按鈕邏輯
        const cta = document.getElementById('cta-btn');
        if (!isQualified) {
            cta.innerText = "需 VIP 10 級方可領取";
            cta.className = "cta-btn btn-disabled";
        } else if (claimedDays >= 25) {
            cta.innerText = "本月獎勵已領完";
            cta.className = "cta-btn btn-disabled";
        } else {
            cta.innerText = "簽到領取本日鑽石";
            cta.className = "cta-btn btn-active";
            cta.onclick = () => alert("已領取鑽石！"); // 此處可對接領取 API
        }

        // 渲染 5 欄網格
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        REWARDS.forEach((amt, index) => {
            const dayNum = index + 1;
            const cell = document.createElement('div');
            cell.className = 'rule-cell';
            if (dayNum <= claimedDays) cell.classList.add('claimed');
            if (dayNum === claimedDays + 1) cell.classList.add('active');
            
            cell.innerHTML = `
                <span class="r-day">${dayNum}天</span>
                <div class="r-amt-row">
                    <svg class="r-icon" viewBox="0 0 24 24"><path fill="#00e5cf" d="M12 22L2 9L12 2L22 9L12 22Z"/></svg>
                    <span class="r-amt">${amt}</span>
                </div>
            `;
            grid.appendChild(cell);
        });
    }

    fetchData();
</script>

</body>
</html>
