<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SWAG DIAMOND ELITE PASS</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --card: #161618;
            --teal: #00e5cf;
            --teal-glow: rgba(0, 229, 207, 0.4);
            --gold: #ffcc00;
            --white: #ffffff;
            --silver: #b0b0b5;
            --border: rgba(255, 255, 255, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--white); font-family: 'Noto Sans TC', sans-serif; padding: 20px; line-height: 1.5; }

        /* 多語系切換 */
        .lang-nav { display: flex; justify-content: flex-end; padding-bottom: 10px; }
        .lang-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #fff; padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 700; cursor: pointer; }

        /* 標題區 */
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 28px; font-weight: 900; letter-spacing: -0.5px; }
        .month-num { color: var(--teal); font-family: 'Montserrat', sans-serif; font-size: 44px; margin-right: 4px; }
        .reset-note { font-size: 13px; color: var(--teal); margin-top: 6px; font-weight: 500; }

        /* 領取英雄區 */
        .hero {
            background: linear-gradient(180deg, #222224 0%, #121214 100%);
            border-radius: 30px; border: 1.5px solid var(--border);
            padding: 30px 20px; margin-bottom: 20px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
        }
        .hero-label { font-size: 15px; color: var(--silver); font-weight: 500; margin-bottom: 10px; }
        .hero-val { 
            font-family: 'Montserrat', sans-serif; font-size: 52px; font-weight: 900; 
            color: var(--white); margin-bottom: 4px; display: flex; align-items: center; justify-content: center; gap: 12px;
        }
        /* 3D 鑽石 SVG */
        .dia-3d { width: 44px; height: 44px; filter: drop-shadow(0 0 10px var(--teal-glow)); }
        .hero-val span { color: var(--teal); text-shadow: 0 0 25px var(--teal-glow); }
        .small-tip { font-size: 12px; color: var(--teal); font-weight: 500; margin-bottom: 20px; }

        .cta-btn {
            width: 100%; padding: 18px; border-radius: 18px; border: none;
            font-size: 18px; font-weight: 900; letter-spacing: 1px; cursor: pointer;
            margin-bottom: 25px; transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-active { background: var(--teal); color: #000; box-shadow: 0 8px 30px var(--teal-glow); }
        .btn-active:active { transform: scale(0.97); }
        .btn-disabled { background: #2a2a2c; color: #555; }

        /* 強化數據看板 */
        .stats-row { display: flex; gap: 12px; }
        .stat-card { 
            flex: 1; background: rgba(0, 229, 207, 0.03); border: 1.5px solid var(--teal); 
            border-radius: 18px; padding: 18px 10px; text-align: center;
            box-shadow: inset 0 0 15px rgba(0, 229, 207, 0.05);
        }
        .stat-lbl { font-size: 12px; color: var(--silver); margin-bottom: 8px; font-weight: 500; }
        .stat-v { font-family: 'Montserrat', sans-serif; font-size: 24px; font-weight: 900; color: var(--white); }

        /* VIP 列 */
        .vip-bar {
            background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            border-radius: 14px; padding: 14px 18px; margin-bottom: 40px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .vip-lv { font-family: 'Montserrat', sans-serif; font-size: 17px; font-weight: 900; color: var(--gold); }
        .vip-st { font-size: 13px; font-weight: 700; }
        .ok { color: #00ff8b; }
        .no { color: #ff3e60; text-decoration: underline; cursor: pointer; }

        /* 規則網格 */
        .grid-header { font-size: 18px; font-weight: 900; margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
        .grid-header::before { content: ''; width: 5px; height: 20px; background: var(--teal); border-radius: 2px; }
        
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px; margin-bottom: 40px; }
        .cell {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 12px; padding: 10px 2px; text-align: center;
        }
        .cell.claimed { opacity: 0.2; }
        .cell.active { border-color: var(--teal); background: rgba(0, 229, 207, 0.05); }
        .c-day { font-size: 10px; font-weight: 500; color: var(--silver); margin-bottom: 6px; display: block; }
        .c-amt-box { display: flex; align-items: center; justify-content: center; gap: 2px; }
        .c-icon { width: 12px; height: 12px; }
        .c-amt { font-family: 'Montserrat', sans-serif; font-size: 13px; font-weight: 700; color: #fff; }

        /* 注意事項 */
        .footer-notes {
            background: rgba(255,255,255,0.02); border-radius: 16px; padding: 20px;
            font-size: 12px; color: var(--silver); line-height: 1.8;
        }
        .footer-notes h4 { color: #fff; font-size: 14px; margin-bottom: 10px; font-weight: 900; }
        .footer-notes ol { padding-left: 18px; }

        .skeleton { height: 60px; background: #1a1a1c; border-radius: 12px; animation: shine 1.5s infinite; }
        @keyframes shine { 0%, 100% { opacity: 0.5; } 50% { opacity: 0.8; } }
    </style>
</head>
<body>

<div class="lang-nav">
    <button class="lang-btn" onclick="toggleLang()" id="lang-btn">English</button>
</div>

<div class="header">
    <h1><span class="month-num" id="m-text">--</span><span id="t-month-suffix">月連續簽到獎勵</span></h1>
    <p class="reset-note" id="t-reset">每月 1 日重置領取天數</p>
</div>

<div class="hero">
    <p class="hero-label" id="t-today-label">本日可領取</p>
    <div class="hero-val">
        <svg class="dia-3d" viewBox="0 0 100 100">
            <defs>
                <linearGradient id="g1" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#00e5cf;stop-opacity:1" />
                </linearGradient>
            </defs>
            <path d="M50 5 L85 35 L50 95 L15 35 Z" fill="url(#g1)"/>
            <path d="M50 5 L15 35 L85 35 Z" fill="white" opacity="0.3"/>
            <path d="M50 95 L15 35 L85 35 Z" fill="black" opacity="0.1"/>
            <path d="M50 5 L50 95" stroke="white" stroke-width="0.5" opacity="0.5"/>
        </svg>
        <span id="v-today">--</span>
    </div>
    <p class="small-tip" id="t-small-tip">鑽石計算包含原登入獎勵 20 鑽</p>
    
    <button id="cta" class="cta-btn btn-disabled">Loading...</button>

    <div class="stats-row">
        <div class="stat-card">
            <p class="stat-lbl" id="t-lbl-claimed">本月已領取</p>
            <p class="stat-v"><span id="v-days">--</span> <small style="font-size:12px;font-weight:700" id="t-unit-day">天</small></p>
        </div>
        <div class="stat-card">
            <p class="stat-lbl" id="t-lbl-total">總計已領取</p>
            <p class="stat-v"><span id="v-total">--</span> <small style="font-size:12px;font-weight:700" id="t-unit-dia">鑽</small></p>
        </div>
    </div>
</div>

<div class="vip-bar">
    <div class="vip-lv" id="v-vip-lv">VIP LV.--</div>
    <div class="vip-st" id="v-vip-st">Checking...</div>
</div>

<div class="grid-header" id="t-grid-title">全月獎勵規則</div>
<div class="grid" id="grid">
    <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
</div>

<div class="footer-notes">
    <h4 id="t-note-title">注意事項：</h4>
    <ol id="t-note-list">
        <li>VIP Lv.10 以上可增加每日登入獎勵領取鑽石。</li>
        <li>鑽石計算包含原登入獎勵 20 鑽，例如 50 鑽 = 20+30 鑽。</li>
        <li>額外贈送鑽石將於領取完登入獎勵 20 鑽後十分鐘內發送至您的帳戶。</li>
    </ol>
</div>

<!-- 鑽石圖示小模板 -->
<svg style="display:none">
    <symbol id="dia-small" viewBox="0 0 100 100">
        <path d="M50 5 L85 35 L50 95 L15 35 Z" fill="#00e5cf"/>
        <path d="M50 5 L15 35 L85 35 Z" fill="white" opacity="0.4"/>
    </symbol>
</svg>

<script>
    // 配置：您的 Cloud Run URL
    const API_URL = "https://swag-user-login-api-xxxxxxx.a.run.app/api/user_login_status";

    const REWARDS = [
        50, 50, 70, 50, 100, 60, 60, 90, 60, 130,
        70, 70, 110, 70, 160, 80, 80, 130, 80, 190,
        90, 90, 150, 90, 300
    ];

    const I18N = {
        'zh-TW': {
            suffix: "月連續簽到獎勵", reset: "每月 1 日重置領取天數", today_l: "本日可領取", 
            tip: "鑽石計算包含原登入獎勵 20 鑽", claimed_l: "本月已領取", total_l: "總計已領取",
            day_u: "天", dia_u: "鑽", grid_t: "全月獎勵規則", note_t: "注意事項：",
            notes: ["VIP Lv.10 以上可增加每日登入獎勵領取鑽石", "鑽石計算包含原登入獎勵 20 鑽，例如 50 鑽 = 20+30 鑽", "額外贈送鑽石將於領取完獎勵後十分鐘內發送至帳戶"],
            vip_ok: "符合資格", vip_no: "不符合資格，立即升級", cta_claim: "簽到領取本日鑽石", cta_lock: "需 VIP 10 級方可領取", cta_done: "本月獎勵已全數領取", day_txt: "天"
        },
        'en': {
            suffix: " MONTH PASS", reset: "Check-in days reset on 1st of each month", today_l: "Today's Reward",
            tip: "Includes base login reward of 20 Diamonds", claimed_l: "Days Claimed", total_l: "Total Earned",
            day_u: "Days", dia_u: "Dia", grid_t: "Monthly Rewards", note_t: "Notes:",
            notes: ["VIP Lv.10+ increases daily login rewards", "Diamonds include base reward of 20 (e.g. 50 = 20+30)", "Bonus diamonds will be sent within 10 mins after claiming"],
            vip_ok: "QUALIFIED", vip_no: "INELIGIBLE, UPGRADE NOW", cta_claim: "CLAIM TODAY", cta_lock: "VIP 10+ REQUIRED", cta_done: "COMPLETED", day_txt: "Day"
        }
    };

    let currentLang = 'zh-TW';
    let dataCache = { total_checkin_days: 0, vip_level: 0 };

    function toggleLang() {
        currentLang = currentLang === 'zh-TW' ? 'en' : 'zh-TW';
        document.getElementById('lang-btn').innerText = currentLang === 'zh-TW' ? 'English' : '繁體中文';
        updateUI(dataCache);
    }

    async function init() {
        const uid = new URLSearchParams(window.location.search).get('user_id') || 'test_user';
        try {
            const res = await fetch(`${API_URL}?user_id=${uid}`);
            dataCache = await res.json();
        } catch (e) { console.error(e); }
        updateUI(dataCache);
    }

    function updateUI(data) {
        const t = I18N[currentLang];
        const claimed = data.total_checkin_days || 0;
        const vip = data.vip_level || 0;
        const isOk = vip >= 10;

        // Header
        const m = data.current_month ? new Date(data.current_month).getMonth() + 1 : new Date().getMonth() + 1;
        document.getElementById('m-text').innerText = m;
        document.getElementById('t-month-suffix').innerText = t.suffix;
        document.getElementById('t-reset').innerText = t.reset;

        // Hero
        document.getElementById('t-today-label').innerText = t.today_l;
        document.getElementById('v-today').innerText = REWARDS[claimed] || 0;
        document.getElementById('t-small-tip').innerText = t.tip;
        document.getElementById('t-lbl-claimed').innerText = t.claimed_l;
        document.getElementById('t-lbl-total').innerText = t.total_l;
        document.getElementById('v-days').innerText = claimed;
        document.getElementById('t-unit-day').innerText = t.day_u;
        document.getElementById('t-unit-dia').innerText = t.dia_u;
        
        let sum = 0;
        for(let i=0; i<claimed; i++) sum += REWARDS[i];
        document.getElementById('v-total').innerText = sum;

        // VIP
        document.getElementById('v-vip-lv').innerText = `VIP LV.${vip}`;
        const st = document.getElementById('v-vip-st');
        st.innerHTML = isOk ? `<span class="ok">${t.vip_ok}</span>` : `<span class="no">${t.vip_no}</span>`;

        // CTA
        const cta = document.getElementById('cta');
        if (!isOk) {
            cta.innerText = t.cta_lock;
            cta.className = "cta-btn btn-disabled";
        } else if (claimed >= 25) {
            cta.innerText = t.cta_done;
            cta.className = "cta-btn btn-disabled";
        } else {
            cta.innerText = t.cta_claim;
            cta.className = "cta-btn btn-active";
        }

        // Grid
        document.getElementById('t-grid-title').innerText = t.grid_t;
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        REWARDS.forEach((amt, i) => {
            const d = i + 1;
            const cell = document.createElement('div');
            cell.className = `cell ${d <= claimed ? 'claimed' : ''} ${d === claimed + 1 ? 'active' : ''}`;
            cell.innerHTML = `
                <span class="c-day">${d}${t.day_txt}</span>
                <div class="c-amt-box">
                    <svg class="c-icon"><use xlink:href="#dia-small"></use></svg>
                    <span class="c-amt">${amt}</span>
                </div>
            `;
            grid.appendChild(cell);
        });

        // Footer
        document.getElementById('t-note-title').innerText = t.note_t;
        document.getElementById('t-note-list').innerHTML = t.notes.map(n => `<li>${n}</li>`).join('');
    }

    init();
</script>

</body>
</html>
